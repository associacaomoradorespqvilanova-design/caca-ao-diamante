<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ca√ßa ao Diamante ‚Äî STUPID & PROJETO X (v25)</title>
<style>
:root{
  --bg1:#2b0464;
  --bg2:#0b3b86;
  --accent-pink:#ff3cac;
  --accent-yellow:#ffd166;
  --bomb:#ff4b5c;
  --diamond1:#b8fff0;
  --diamond2:#00c9a7;
  --conf1:#ffdd57;
  --conf2:#ff6b6b;
  --conf3:#6bffb8;
  --conf4:#6bb0ff;
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background:linear-gradient(120deg,var(--bg1),var(--bg2));
  color:#fff;display:flex;align-items:center;justify-content:center;
  padding:18px;min-height:100vh;overflow:hidden;
}
.bg-osc{
  position:fixed;inset:0;z-index:0;pointer-events:none;
  background:linear-gradient(90deg,rgba(120,60,200,0.06),rgba(0,180,255,0.06));
  /* lighter filter for better perf */
  filter: blur(8px) saturate(1.02);
}
.wrap{width:100%;max-width:1100px;border-radius:14px;padding:18px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 18px 60px rgba(0,0,0,0.6);position:relative;z-index:2;}
.logoWrap{display:flex;justify-content:center;margin-bottom:12px;position:relative;z-index:1100;}
.logo-svg{width:360px;max-width:90%;border-radius:8px;box-shadow:0 12px 36px rgba(0,0,0,0.45);display:block;}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:6px;}
h1{font-weight:700;font-size:22px;color:var(--accent-yellow);font-family: "Anton", sans-serif;}
#status{font-weight:600;}
.contentRow{display:flex;gap:18px;align-items:flex-start;margin-top:12px;flex-wrap:wrap;}
.gameArea{flex:1 1 580px;min-width:260px;}
.charArea{width:220px;display:flex;align-items:center;justify-content:center;}
.char-svg{width:200px;max-width:100%;}
#grid{display:grid;grid-template-columns:repeat(6,64px);grid-gap:10px;justify-content:center;margin-top:14px;padding-bottom:14px;}
.cell{width:64px;height:64px;border-radius:10px;border:2px solid rgba(255,255,255,0.05);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease;background:#ffd966;font-weight:700;color:#04203a;user-select:none;}
.cell:active{transform:translateY(2px)}
.cell.revealed{pointer-events:none;opacity:0.95;}
.cell.bomba{background:radial-gradient(circle,#ff4b5c,#b00020);color:#fff;}
.cell.diamante{background:linear-gradient(135deg,var(--diamond1),var(--diamond2));color:#003;box-shadow:0 10px 36px rgba(0,201,167,0.18);}
.diamondIcon{font-size:22px;animation:sparkle 1s linear infinite;}
@keyframes sparkle{0%{transform:scale(1)}50%{transform:scale(1.14)}100%{transform:scale(1)}}
#senhaArea{margin-top:12px;text-align:center;color:#fff;display:none;}
#senhaArea input{padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.25);color:#fff;margin-right:8px;}
#senhaArea button{padding:8px 10px;border-radius:6px;border:none;cursor:pointer;background:#ffd166;color:#04203a;}
#bannerBloqueio{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:1000;max-width:92%;background:linear-gradient(90deg,#ff4b5c,#b00020);padding:14px;text-align:center;font-weight:700;font-size:20px;border-radius:10px;box-shadow:0 20px 60px rgba(0,0,0,0.6);}
.introOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.85);z-index:20;padding:20px;}
.introCard{width:100%;max-width:820px;background:rgba(255,255,255,0.05);border-radius:12px;padding:20px;box-shadow:0 20px 60px rgba(0,0,0,0.6);text-align:center;max-height:80vh;overflow:auto;}
.introLogo{width:320px;max-width:85%;margin:0 auto 8px;display:block;border-radius:8px;}
.typed{text-align:left;white-space:pre-wrap;line-height:1.45;font-size:16px;color:#fff;margin:12px 6px;min-height:140px;}
.rowBtns{display:flex;gap:12px;justify-content:center;margin-top:12px;flex-wrap:wrap;}
.btn{font-family:inherit;border:0;cursor:pointer;padding:10px 18px;border-radius:10px;font-size:16px;}
.btnPlay{background:linear-gradient(90deg,var(--accent-pink),#ff7eb3);color:var(--accent-yellow);}
.btnStart{background:linear-gradient(90deg,#66a6ff,#89f7fe);color:#04203a;}
#victoryOverlay{position:fixed;inset:0;display:none;z-index:40;align-items:center;justify-content:center;flex-direction:column;gap:20px;background:rgba(3,7,18,0.9);text-align:center;}
#victoryOverlay .winText{font-weight:900;font-size:64px;letter-spacing:4px;color:var(--accent-yellow);animation:blink 900ms steps(2,start) infinite;}
@keyframes blink{50%{opacity:0.05;transform:scale(1.02)}100%{opacity:1;transform:scale(1)}}
.confetti{position:fixed;width:10px;height:16px;z-index:39;pointer-events:none;opacity:0.95;animation:fall linear forwards;}
@keyframes fall{to{transform:translateY(110vh)rotate(720deg);opacity:0.95;}}
/* mobile perf: remove heavy animation and simplify bg */
@media (max-width:900px){
  .contentRow{flex-direction:column-reverse;align-items:center;}
  #grid{grid-template-columns:repeat(5,56px);}
  h1{font-size:16px;}
  .logoWrap{position:fixed;top:10px;left:50%;transform:translateX(-50%);}
  .logo-svg{width:220px;}
  .wrap{padding-top:80px;}
  .char-svg{width:160px;}
  #senhaArea{
    position:fixed;
    bottom:0;
    left:0;
    right:0;
    background:rgba(0,0,0,0.8);
    padding:12px;
    border-top:2px solid rgba(255,255,255,0.1);
    z-index:1001;
  }
  #senhaArea input{width:60%;max-width:220px;margin-bottom:6px;}
  #senhaArea button{margin-top:4px;}
  .bg-osc{display:none}
}
</style>
</head>
<body>
<div class="bg-osc"></div>
<div class="wrap">
  <div class="logoWrap">
    <!-- INLINE SVG LOGO (offline) -->
    <svg class="logo-svg" viewBox="0 0 900 240" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="STUPID & PROJETO X logo">
      <defs>
        <linearGradient id="g1" x1="0" x2="1">
          <stop offset="0" stop-color="#ff6fa6"/>
          <stop offset="1" stop-color="#66a6ff"/>
        </linearGradient>
      </defs>
      <rect rx="18" width="900" height="240" fill="rgba(0,0,0,0.08)"/>
      <text x="50" y="120" font-family="Anton, Impact, sans-serif" font-size="72" fill="url(#g1)">STUPID</text>
      <text x="420" y="120" font-family="Segoe UI, Roboto, Arial" font-weight="700" font-size="40" fill="#ffd166">&nbsp;& &nbsp;PROJETO X</text>
      <g transform="translate(760,30) scale(0.8)">
        <rect width="120" height="120" rx="20" fill="#b8fff0" />
        <text x="60" y="75" font-size="56" text-anchor="middle" font-weight="700" fill="#003">üíé</text>
      </g>
    </svg>
  </div>

  <div id="bannerBloqueio">üíÄ Voc√™ perdeu ‚Äî acesso bloqueado.</div>
  <div class="header"><h1>üíé Ca√ßa ao Diamante</h1><div id="status">Carregando...</div></div>
  <div class="contentRow">
    <div class="gameArea">
      <div id="grid" aria-hidden="false"></div>
      <div id="senhaArea">
        <p>üîí Jogo bloqueado. Insira a senha para desbloquear:</p>
        <input id="senhaInput" placeholder="Senha" aria-label="Senha de desbloqueio">
        <button id="btnDesbloquear">Desbloquear</button>
        <p id="senhaMsg" style="color:#ffd166"></p>
      </div>
    </div>

    <div class="charArea">
      <!-- INLINE SVG CHARACTER (offline placeholder) -->
      <svg class="char-svg" viewBox="0 0 300 300" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Personagem">
        <defs>
          <linearGradient id="skin" x1="0" x2="1"><stop offset="0" stop-color="#ffd7b2"/><stop offset="1" stop-color="#ffb78a"/></linearGradient>
        </defs>
        <rect width="300" height="300" rx="20" fill="rgba(255,255,255,0.02)"/>
        <circle cx="150" cy="110" r="50" fill="url(#skin)"/>
        <ellipse cx="150" cy="210" rx="70" ry="40" fill="#66a6ff"/>
        <text x="150" y="115" text-anchor="middle" font-size="32" font-weight="700" fill="#04203a">üë§</text>
      </svg>
    </div>
  </div>
</div>

<div id="introOverlay" class="introOverlay" style="display:none;">
  <div class="introCard" role="dialog" aria-label="Introdu√ß√£o">
    <svg class="introLogo" viewBox="0 0 900 200" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
      <rect width="900" height="200" rx="14" fill="rgba(255,255,255,0.02)"/>
      <text x="24" y="120" font-family="Anton, sans-serif" font-size="64" fill="#ffd166">Ca√ßa ao Diamante</text>
    </svg>
    <div class="typed" id="typedArea"></div>
    <div class="rowBtns">
      <button id="btnPlay" class="btn btnPlay">‚ñ∂ PLAY</button>
      <button id="btnSkip" class="btn btnStart">PULAR</button>
      <button id="btnStart" class="btn btnStart" style="display:none">VAMOS L√Å</button>
    </div>
  </div>
</div>

<div id="victoryOverlay">
  <svg style="width:360px;max-width:80%;height:auto" viewBox="0 0 900 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <rect width="900" height="240" rx="18" fill="rgba(255,255,255,0.02)"/>
    <text x="50" y="140" font-family="Anton, sans-serif" font-size="72" fill="#ffd166">VOC√ä GANHOU!</text>
  </svg>
  <div class="winText">VOC√ä GANHOU!</div>
</div>

<script>
/* --------------- v25: offline / mobile-friendly improvements --------------- */

/*
  Changes from v24:
  - Images replaced by inline SVG (no network required)
  - All localStorage access wrapped in try/catch to avoid init freeze on some mobiles
  - Background blur reduced; hidden on small screens
  - Same gameplay logic preserved
*/

const TOTAL_CELLS = 30;
let chances = 10;
let diamantesEncontrados = 0;
let bloqueado = false;
let senhasUsadas = [];
let introSeen = false;

try {
  // guardado em try/catch para evitar travar em browsers que n√£o permitem localStorage
  bloqueado = (localStorage.getItem('v24_bloqueado') === 'true');
} catch (e) {
  bloqueado = false;
}
try {
  senhasUsadas = JSON.parse(localStorage.getItem('v24_senhasUsadas') || "[]");
} catch (e) {
  senhasUsadas = [];
}
try {
  introSeen = (localStorage.getItem('v24_introSeen') === 'true');
} catch(e){
  introSeen = false;
}

const senhasValidas = ["G7K2","M4Q9","T8R3","Z5L7","B9D1","H6W8","N2P5","K3Y4","R7S9","V1C6"];
const MASTER_PASSWORD = "SUPERMASTER2025";

const gridEl = document.getElementById('grid'),
      statusEl = document.getElementById('status'),
      senhaArea = document.getElementById('senhaArea'),
      senhaInput = document.getElementById('senhaInput'),
      senhaMsg = document.getElementById('senhaMsg'),
      bannerBloqueio = document.getElementById('bannerBloqueio'),
      introOverlay = document.getElementById('introOverlay'),
      typedArea = document.getElementById('typedArea'),
      btnPlay = document.getElementById('btnPlay'),
      btnSkip = document.getElementById('btnSkip'),
      btnStart = document.getElementById('btnStart'),
      victoryOverlay = document.getElementById('victoryOverlay');

function saveState(){
  try {
    localStorage.setItem('v24_bloqueado', bloqueado);
    localStorage.setItem('v24_senhasUsadas', JSON.stringify(senhasUsadas));
    localStorage.setItem('v24_introSeen', introSeen);
  } catch (e) {
    // se falhar, ignorar - evita bloqueio
    console.warn('localStorage inacess√≠vel:', e && e.message);
  }
}

function gerarDiamante(){ return Math.floor(Math.random()*TOTAL_CELLS); }
function atualizarStatus(){ statusEl.textContent = `üíé ${diamantesEncontrados}/5 | ‚ù§Ô∏è ${chances} chances`; }

function desenharGrid(){
  gridEl.innerHTML = '';
  for (let i = 0; i < TOTAL_CELLS; i++) {
    const c = document.createElement('div');
    c.className = 'cell';
    c.setAttribute('role','button');
    c.setAttribute('aria-label','quadrado '+(i+1));
    c.addEventListener('click', () => clicarCelula(i, c));
    gridEl.appendChild(c);
  }
}

let posDiamante = 0;
function clicarCelula(i, c){
  if (bloqueado || chances <= 0) return;
  if (c.classList.contains('revealed')) return;
  c.classList.add('revealed');
  if (i === posDiamante) {
    c.classList.add('diamante');
    // diamantinho em texto (compat√≠vel com qualquer device)
    c.innerHTML = '<span class="diamondIcon">üíé</span>';
    diamantesEncontrados++;
    chances = 10;
    atualizarStatus();
    if (diamantesEncontrados >= 5) {
      setTimeout(()=>{ showVictory(); bloqueado = true; saveState(); }, 300);
      return;
    }
    setTimeout(iniciarRodada, 700);
  } else {
    c.classList.add('bomba');
    c.innerHTML = 'üí£';
    chances--;
    atualizarStatus();
    if (chances <= 0) perderJogo();
  }
}

function perderJogo(){
  bloqueado = true;
  saveState();
  bannerBloqueio.style.display = 'block';
  senhaArea.style.display = 'block';
}

function verificarSenhaInput(){
  const v = (senhaInput.value || '').trim().toUpperCase();
  senhaInput.value = '';
  if (!v) return;
  if (v === MASTER_PASSWORD) {
    senhasUsadas = [];
    bloqueado = false;
    chances = 10;
    diamantesEncontrados = 0;
    saveState();
    senhaArea.style.display = 'none';
    bannerBloqueio.style.display = 'none';
    iniciarRodada();
    alert('‚ú® Senha mestra aceita ‚Äî todas reativadas!');
    return;
  }
  if (senhasValidas.includes(v) && !senhasUsadas.includes(v)) {
    senhasUsadas.push(v);
    bloqueado = false;
    chances = 10;
    diamantesEncontrados = 0;
    saveState();
    senhaArea.style.display = 'none';
    bannerBloqueio.style.display = 'none';
    iniciarRodada();
  } else senhaMsg.textContent = '‚ùå Senha inv√°lida.';
}

function iniciarRodada(){
  // seguran√ßa adicional: se GRID n√£o cabe na tela (alguns browsers antigos), recria com menos colunas
  try {
    posDiamante = gerarDiamante();
    desenharGrid();
    atualizarStatus();
  } catch (e) {
    // fallback simples
    gridEl.innerHTML = '';
    for (let i=0;i<10;i++){
      const c=document.createElement('div');
      c.className='cell';
      c.textContent='?';
      gridEl.appendChild(c);
    }
    statusEl.textContent = 'Erro ao desenhar o tabuleiro ‚Äî vers√£o simplificada.';
  }
}

/* Intro typing */
const lines = [
  "STUPID üíé & PROJETO X üöÄ se uniram ‚Äî quem ganha √© voc√™!",
  "",
  "Encontre 5 diamantes escondidos e ganhe:",
  "- VIP na STUPID",
  "- Uma surpresa exclusiva da PROJETO X",
  "",
  "Como jogar:",
  "Voc√™ tem 10 chances.",
  "Toque num quadrado.",
  "üí£ bomba = perde 1 chance.",
  "üíé diamante = tabuleiro reinicia.",
  "",
  "Ache os 5 diamantes antes de acabar as chances. Boa sorte!"
];

btnPlay.onclick = () => { btnPlay.disabled = true; typeIntro(lines, typedArea, ()=> btnStart.style.display = 'inline-block'); };
btnSkip.onclick = () => { introSeen = true; saveState(); introOverlay.style.display = 'none'; gridEl.style.display = 'grid'; iniciarRodada(); };
btnStart.onclick = () => { introSeen = true; saveState(); introOverlay.style.display = 'none'; gridEl.style.display = 'grid'; iniciarRodada(); };
document.getElementById('btnDesbloquear').onclick = verificarSenhaInput;

function typeIntro(lines, el, cb){
  el.textContent = '';
  let i = 0;
  function next(){
    if (i >= lines.length) { cb(); return; }
    const line = lines[i++]; let j = 0;
    (function t(){
      el.textContent += line[j++] || '';
      if (j < line.length) setTimeout(t, 18); // slightly faster
      else { el.textContent += '\n'; setTimeout(next, 120); }
    })();
  }
  next();
}

function showVictory(){
  statusEl.style.display = 'none';
  gridEl.style.display = 'none';
  senhaArea.style.display = 'none';
  bannerBloqueio.style.display = 'none';
  victoryOverlay.style.display = 'flex';
  launchConfetti(90);
}

function launchConfetti(n){
  const colors = ['var(--conf1)','var(--conf2)','var(--conf3)','var(--conf4)'];
  for(let i=0;i<n;i++){
    const c = document.createElement('div');
    c.className = 'confetti';
    c.style.left = Math.random()*100 + 'vw';
    c.style.top = '-10vh';
    c.style.background = colors[Math.floor(Math.random()*colors.length)];
    c.style.animationDuration = 3 + Math.random()*3 + 's';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(), 6000);
  }
}

/* Initialization: try/catch to avoid freeze if something goes wrong */
(function init(){
  try {
    gridEl.style.display = 'none';
    bannerBloqueio.style.display = 'none';
    if (!introSeen) {
      introOverlay.style.display = 'flex';
    } else {
      gridEl.style.display = 'grid';
      if (bloqueado) perderJogo();
      else iniciarRodada();
    }
  } catch (e) {
    // fallback: show simplified board so user can still play
    console.error('Erro na inicializa√ß√£o:', e && e.message);
    gridEl.innerHTML = '';
    for (let i=0;i<12;i++){
      const c=document.createElement('div');
      c.className='cell';
      c.textContent='?';
      gridEl.appendChild(c);
    }
    gridEl.style.display = 'grid';
    statusEl.textContent = 'Modo compat√≠vel ativado';
  }
})();

/* Optional: clear very old state if corrupted (keeps user from stuck states) */
(function cleanupIfCorrupted(){
  // if senhasUsadas is not an array (corrupted), reset it
  if (!Array.isArray(senhasUsadas)) {
    senhasUsadas = [];
    saveState();
  }
})();
</script>
</body>
</html>
